% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/select_lengthscales.R
\name{select_lengthscales}
\alias{select_lengthscales}
\title{Select Optimal Length Scales for Spatial Analysis}
\usage{
select_lengthscales(
  Y,
  spatial_coords,
  n_lengthscales = 5,
  M = 1,
  is.inverse = TRUE,
  n_workers = 1
)
}
\arguments{
\item{Y}{Normalized count matrix. Rows and columns indicate genes and spots, respectively.}

\item{spatial_coords}{Spatial coordinates matrix. Rows indicate spots.}

\item{n_lengthscales}{Number of length-scales (i.e., number of kernels). Default is 5.}

\item{M}{Controls the minimum length-scale. Minimum length-scale is set to be
the minimum distance multiplied by M. Default is 1.}

\item{is.inverse}{Should the inverse of lengthscale (phi) be returned? Default is TRUE.}

\item{n_workers}{Number of workers for parallelization. Default is 1.}
}
\value{
A list containing:
\describe{
\item{phi_mat}{Matrix of selected length scale parameters (phi = 1/lengthscale)
for each gene. Each row corresponds to a gene.}
\item{time}{Vector of computation times for each gene.}
}
}
\description{
Automatically selects optimal length scales (kernel bandwidths) for spatial
gene expression analysis using a two-step approach based on non-negative
least squares fitting.
}
\details{
This function implements a two-step approach for selecting optimal length scales:
\enumerate{
\item First, it fits models across a broad range of length scales
\item Then, for each gene, it identifies the range where variance components are non-zero
\item Finally, it selects gene-specific length scales within those ranges
}

The function uses \code{\link{run_nnls}} internally to fit non-negative least
squares models for each gene across different length scales.
}
\examples{
\dontrun{
# Generate example data
set.seed(123)
n_spots <- 100
n_genes <- 20
coords <- matrix(runif(n_spots * 2), ncol = 2)
expr_data <- matrix(rnorm(n_genes * n_spots), nrow = n_genes)

# Select optimal length scales
length_scales <- select_lengthscales(
  Y = expr_data,
  spatial_coords = coords,
  n_lengthscales = 5
)

# View selected scales for first few genes
head(length_scales$phi_mat)
}

}
\seealso{
\code{\link{run_nnls}}, \code{\link{spacelink_global}}
}
\keyword{internal}
